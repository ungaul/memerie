<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Meme Uploader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        form,
        .meme-item {
            margin-bottom: 20px;
        }

        img {
            max-width: 200px;
            display: block;
        }
    </style>
</head>

<body>
    <h1>Upload a Meme</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="note">Note:</label>
        <input type="text" id="note" name="note"><br><br>
        <label for="meme">Meme Image:</label>
        <input type="file" id="meme" name="meme" accept="image/*"><br><br>
        <button type="submit">Upload</button>
    </form>

    <h1>List of Memes</h1>
    <button id="loadMemes">Load Memes</button>
    <div id="memeList"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            try {
                const response = await fetch('https://memerie.vercel.app/api/upload', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.status === 'success') {
                    alert('Upload successful!');
                    document.getElementById('uploadForm').reset();
                } else {
                    alert('Upload failed: ' + result.error);
                }
            } catch (error) {
                console.error('Error uploading meme:', error);
            }
        });

        document.getElementById('loadMemes').addEventListener('click', async function () {
            try {
                const response = await fetch('https://memerie.vercel.app/api/list');
                const result = await response.json();
                const memeList = document.getElementById('memeList');
                memeList.innerHTML = '';
                if (result.status === 'success') {
                    result.data.forEach(file => {
                        const div = document.createElement('div');
                        div.classList.add('meme-item');
                        div.innerHTML = `
              <strong>${file.name}</strong><br>
              Note: ${file.description || ''}<br>
              <img src="${file.webContentLink}" alt="${file.name}">
            `;
                        memeList.appendChild(div);
                    });
                } else {
                    memeList.textContent = 'Error loading memes: ' + result.error;
                }
            } catch (error) {
                console.error('Error fetching memes:', error);
            }
        });
    </script>
</body>

</html>